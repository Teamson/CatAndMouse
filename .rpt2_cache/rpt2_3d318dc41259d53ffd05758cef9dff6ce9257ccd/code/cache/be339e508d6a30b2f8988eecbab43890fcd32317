{
  "code": "import WxApi from \"../Libs/WxApi\";\r\nimport Mouse from \"./Mouse\";\r\nimport Capsule from \"./Capsule\";\r\nimport Cat from \"./Cat\";\r\nimport Cheese from \"./Cheese\";\r\nimport PlayerDataMgr from \"../Libs/PlayerDataMgr\";\r\nimport Clip from \"./Clip\";\r\nimport TimeCountMgr from \"../Libs/TimeCountMgr\";\r\nimport ShareMgr from \"../Mod/ShareMgr\";\r\nexport default class GameLogicCrl {\r\n    constructor() {\r\n        this._gradeScene = null;\r\n        this._Cat = null;\r\n        this._MouseNode = null;\r\n        this.currentCollNode = null;\r\n        this.currentPointsNode = null;\r\n        this.currentPosNode = null;\r\n        this.validPointArr = [];\r\n        this.propNode = null;\r\n        this.cheeseId = -1;\r\n        this.countForWin = 10;\r\n        this.isVictory = false;\r\n        this.isDefeat = false;\r\n        this.isOver = false;\r\n        localStorage.clear();\r\n        GameLogicCrl.Share = this;\r\n        ShareMgr.instance.initShare();\r\n        PlayerDataMgr.getPlayerData();\r\n        new TimeCountMgr();\r\n        Laya.Scene.open('MyScenes/LoadingUI.scene');\r\n    }\r\n    initScene() {\r\n        Laya.Scene3D.load(WxApi.UnityPath + 'Scene1.ls', Laya.Handler.create(this, this.onLoadScene));\r\n    }\r\n    onLoadScene(scene) {\r\n        this._scene = Laya.stage.addChild(scene);\r\n        Laya.stage.setChildIndex(this._scene, 0);\r\n        this._camera = this._scene.getChildByName('Main Camera');\r\n        this._light = this._scene.getChildByName('Directional Light');\r\n        this.createGameScene();\r\n    }\r\n    createGameScene() {\r\n        let curGid = PlayerDataMgr.getPlayerData().grade;\r\n        let sceneRes = Laya.loader.getRes(WxApi.UnityPath + 'Scene' + curGid + '.lh');\r\n        this._gradeScene = Laya.Sprite3D.instantiate(sceneRes, this._scene, false, new Laya.Vector3(0, 0, 0));\r\n        this._Cat = this._gradeScene.getChildByName('Cat');\r\n        this._MouseNode = this._gradeScene.getChildByName('MouseNode');\r\n        this.currentCollNode = this._gradeScene.getChildByName('CollNode');\r\n        this.currentPointsNode = this._gradeScene.getChildByName('PointNode');\r\n        this.currentPosNode = this._gradeScene.getChildByName('PosNode');\r\n        this.propNode = this._gradeScene.getChildByName('PropNode');\r\n        this.addCollComponents();\r\n        this.addPropComponents();\r\n        this.countForWin = this._MouseNode.numChildren - 3;\r\n        for (let i = 0; i < this._MouseNode.numChildren; i++) {\r\n            let mouse = this._MouseNode.getChildAt(i);\r\n            mouse.addComponent(Mouse);\r\n        }\r\n        if (this._Cat)\r\n            this._Cat.addComponent(Cat);\r\n    }\r\n    addCollComponents() {\r\n        for (let i = 0; i < this.currentCollNode.numChildren; i++) {\r\n            let coll = this.currentCollNode.getChildAt(i);\r\n            coll.addComponent(Capsule);\r\n        }\r\n    }\r\n    addPropComponents() {\r\n        if (this.propNode.getChildByName('Cheese')) {\r\n            let c = this.propNode.getChildByName('Cheese');\r\n            c.addComponent(Cheese);\r\n            if (c.numChildren > 0) {\r\n                this.cheeseId = parseInt(c.getChildAt(0).name);\r\n            }\r\n        }\r\n        if (this.propNode.getChildByName('Clip')) {\r\n            let c = this.propNode.getChildByName('Clip');\r\n            c.addComponent(Clip);\r\n        }\r\n    }\r\n    getPropByName(name) {\r\n        return this.propNode.getChildByName(name);\r\n    }\r\n    mouseIsCaught(mouse) {\r\n        mouse.destroy();\r\n        if (this._MouseNode.numChildren < this.countForWin) {\r\n            this.gameOverCallback();\r\n        }\r\n    }\r\n    winCallback() {\r\n        if (this.isVictory)\r\n            return;\r\n        this.isVictory = true;\r\n        this.isOver = true;\r\n        Laya.Scene.open('MyScenes/VictoryUI.scene');\r\n    }\r\n    gameOverCallback() {\r\n        if (this.isDefeat)\r\n            return;\r\n        this.isDefeat = true;\r\n        this.isOver = true;\r\n        Laya.Scene.open('MyScenes/DefeatUI.scene');\r\n    }\r\n    restartGame() {\r\n        this.isVictory = false;\r\n        this.isDefeat = false;\r\n        this.isOver = false;\r\n        this._gradeScene.removeChildren();\r\n        this._gradeScene.removeSelf();\r\n        this._gradeScene = null;\r\n        this.createGameScene();\r\n    }\r\n}\r\n",
  "references": [
    "E:/LayaProjects/CatAndMouse/src/Libs/WxApi.ts",
    "E:/LayaProjects/CatAndMouse/src/Crl/Mouse.ts",
    "E:/LayaProjects/CatAndMouse/src/Crl/Capsule.ts",
    "E:/LayaProjects/CatAndMouse/src/Crl/Cat.ts",
    "E:/LayaProjects/CatAndMouse/src/Crl/Cheese.ts",
    "E:/LayaProjects/CatAndMouse/src/Libs/PlayerDataMgr.ts",
    "E:/LayaProjects/CatAndMouse/src/Crl/Clip.ts",
    "E:/LayaProjects/CatAndMouse/src/Libs/TimeCountMgr.ts",
    "E:/LayaProjects/CatAndMouse/src/Mod/ShareMgr.ts"
  ]
}
