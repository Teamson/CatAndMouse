{
  "code": "import GameLogicCrl from \"../Crl/GameLogicCrl\";\r\nimport Utility from \"../Mod/Utility\";\r\nimport CollCrl from \"../Crl/CollCrl\";\r\nexport default class GameUI extends Laya.Scene {\r\n    constructor() {\r\n        super();\r\n        this.selectColl = null;\r\n        this.collMoveDir = new Laya.Vector3(0, 0, 0);\r\n        this.prePos = new Laya.Vector2(0, 0);\r\n        this.touchPanel = this['touchPanel'];\r\n    }\r\n    onOpened(param) {\r\n        this.initData();\r\n    }\r\n    onClosed() {\r\n    }\r\n    initData() {\r\n        this.touchPanel.on(Laya.Event.MOUSE_DOWN, this, this.touchStart);\r\n        this.touchPanel.on(Laya.Event.MOUSE_MOVE, this, this.touchMove);\r\n        this.touchPanel.on(Laya.Event.MOUSE_UP, this, this.touchEnd);\r\n    }\r\n    touchStart(event) {\r\n        let pos = new Laya.Vector2(event.stageX, event.stageY);\r\n        this.prePos = pos.clone();\r\n        let ray = new Laya.Ray(new Laya.Vector3(0, 0, 0), new Laya.Vector3(0, 0, 0));\r\n        let result = [];\r\n        GameLogicCrl.Share._camera.viewportPointToRay(pos, ray);\r\n        GameLogicCrl.Share._scene.physicsSimulation.rayCastAll(ray, result);\r\n        if (result.length > 0) {\r\n            for (let i = 0; i < result.length; i++) {\r\n                let res = result[i];\r\n                if (res.succeeded && res.collider.owner.name.search('Cylinder_1') != -1) {\r\n                    console.log('射线检测：', res.collider.owner.name);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    touchMove(event) {\r\n        if (!this.selectColl)\r\n            return;\r\n        let ccrl = this.selectColl.getComponent(CollCrl);\r\n        let pos = new Laya.Vector2(event.stageX, event.stageY);\r\n        let dir = new Laya.Vector2(pos.x - this.prePos.x, pos.y - this.prePos.y);\r\n        let dis = Utility.calcDistance(this.prePos, pos) / 50;\r\n        Laya.Vector2.normalize(dir, dir);\r\n        let angle = Utility.getAngle(new Laya.Vector3(dir.x, 0, dir.y), new Laya.Vector3(this.collMoveDir.x, 0, this.collMoveDir.z));\r\n        if (angle >= 90) {\r\n            let p = new Laya.Vector3(this.collMoveDir.x * dis, this.collMoveDir.y * dis, this.collMoveDir.z * dis);\r\n            Laya.Vector3.add(this.selectColl.transform.position.clone(), p, p);\r\n            this.selectColl.transform.position = ccrl.fixPos(p.clone(), true);\r\n        }\r\n        else {\r\n            let p = new Laya.Vector3(this.collMoveDir.x * -dis, this.collMoveDir.y * -dis, this.collMoveDir.z * -dis);\r\n            Laya.Vector3.add(this.selectColl.transform.position.clone(), p, p);\r\n            this.selectColl.transform.position = ccrl.fixPos(p.clone(), false);\r\n        }\r\n        this.prePos = pos.clone();\r\n    }\r\n    touchEnd(event) {\r\n        this.selectColl = null;\r\n    }\r\n}\r\n",
  "references": [
    "E:/LayaProjects/CatAndMouse/src/Crl/GameLogicCrl.ts",
    "E:/LayaProjects/CatAndMouse/src/Mod/Utility.ts",
    "E:/LayaProjects/CatAndMouse/src/Crl/CollCrl.ts"
  ]
}
