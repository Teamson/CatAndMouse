!function(){"use strict";class e{static LoginWx(e){if(!Laya.Browser.onWeiXin)return;let t=Laya.Browser.window.wx.getLaunchOptionsSync();Laya.Browser.window.wx.login({success(a){a.code&&(console.log("res.code:",a.code),e&&e(a.code,t.query))}})}static checkScope(e){Laya.Browser.onWeiXin&&Laya.Browser.window.wx.getSetting({success:t=>{t.authSetting["scope.userInfo"]?console.log("已经授权"):(console.log("没有授权"),this.createScope(e))}})}static createScope(e){this.scopeBtn=Laya.Browser.window.wx.createUserInfoButton({type:"text",text:"",style:{left:e.x,top:e.y,width:e.width,height:e.height,lineHeight:40,backgroundColor:"#ffffff",color:"#ffffff",textAlign:"center",fontSize:16,borderRadius:0}}),this.scopeBtn.onTap(e=>{"getUserInfo:ok"==e.errMsg?(this.scopeBtn.destroy(),this.scopeBtn=null):"getUserInfo:fail auth deny"==e.errMsg&&(this.scopeBtn.destroy(),this.scopeBtn=null)})}static GetLaunchParam(e){Laya.Browser.onWeiXin&&(this.OnShowFun=e,e(this.GetLaunchPassVar()),Laya.Browser.window.wx.onShow(e=>{null!=this.OnShowFun&&this.OnShowFun(e),console.log("wx on show")}))}static GetLaunchPassVar(){return Laya.Browser.onWeiXin?Laya.Browser.window.wx.getLaunchOptionsSync():null}static WxOnHide(e){Laya.Browser.onWeiXin&&Laya.Browser.window.wx.onHide(e)}static httpRequest(e,t,a="get",i){var s=new Laya.HttpRequest;s.http.timeout=5e3,s.once(Laya.Event.COMPLETE,this,i),s.once(Laya.Event.ERROR,this,this.httpRequest,[e,t,a,i]),"get"==a?s.send(e+"?"+t,"",a,"text"):"post"==a&&s.send(e,JSON.stringify(t),a,"text")}static DoVibrate(e=!0){Laya.Browser.onWeiXin&&this.isVibrate&&(e?Laya.Browser.window.wx.vibrateShort():Laya.Browser.window.wx.vibrateLong())}static OpenAlert(e,t=2e3,a=!1){Laya.Browser.onWeiXin&&Laya.Browser.window.wx.showToast({title:e,duration:t,mask:!1,icon:a?"success":"none"})}static NavigateApp(e,t,a,i,s){if(Laya.Browser.onWeiXin){Laya.Browser.window.wx.navigateToMiniProgram({appId:e,path:t,success(e){console.log("打开成功"),s()},fail(e){console.log("打开失败"),i()}})}}static preViewImage(e){Laya.Browser.onWeiXin&&Laya.Browser.window.wx.previewImage({current:e,urls:[e]})}static aldEvent(e){Laya.Browser.onWeiXin&&Laya.Browser.window.wx.aldSendEvent(e)}}e.UnityPath="LayaScene_Scene1/Conventional/",e.version="1.0.0",e.isVibrate=!0,e.isMusic=!0,e.OnShowFun=null,e.scopeBtn=null,e.shareCallback=null,e.front_share_number=0,e.gotOfflineBounes=!1,e.configData=null,e.shareTime=0,e.firstShare=!0,e.hadShowFriendUI=!1,e.launchGameUI=!1,e.firstStartGame=!1;class t extends Laya.Script3D{constructor(){super(),this.myOwner=null,this.startPos=new Laya.Vector3(0,0,0),this.myDir=new Laya.Vector3(0,0,0),this.moveDis=6,this.isOpen=!1}onAwake(){this.myOwner=this.owner,this.startPos=this.myOwner.transform.position.clone(),this.myOwner.transform.getUp(this.myDir),this.myDir=new Laya.Vector3(-this.myDir.x,-this.myDir.y,-this.myDir.z)}clicked(){if(this.isOpen)this.myOwner.transform.position=this.startPos.clone();else{let e=new Laya.Vector3(this.myDir.x*this.moveDis,this.myDir.y*this.moveDis,this.myDir.z*this.moveDis),t=new Laya.Vector3(0,0,0);Laya.Vector3.add(this.myOwner.transform.position.clone(),e,t),this.myOwner.transform.position=t}this.isOpen=!this.isOpen}}var a;!function(e){e.PROP_CLIP="Clip",e.PROP_INDOOR="InDoor",e.PROP_OUTDOOR="OutDoor",e.PROP_PEPPER="Pepper",e.PROP_COIN="Coin",e.PROP_FIRE="Fire",e.PROP_CHEESE="Cheese",e.PROP_DESDOOR="DesDoor"}(a||(a={}));class i extends Laya.Script3D{constructor(){super(),this.myOwner=null,this._body=null,this._ani=null,this.targetNode=null,this.tempTargetNode=null,this.pointTarget=null,this.isToPoint=!1,this.isGotDes=!1,this.isGotCheese=!1,this.isHurt=!1,this.curId=0,this.speed=.02}onAwake(){this.myOwner=this.owner,this._ani=this.myOwner.getComponent(Laya.Animator),this.playAniByName("idle"),this._body=this.myOwner.getComponent(Laya.Rigidbody3D),this.tempTargetNode=u.Share.currentPointsNode.getChildAt(0)}playAniByName(e){this._ani.play(e)}getValidPos(){let e=[];for(let a=0;a<u.Share.currentCollNode.numChildren;a++){u.Share.currentCollNode.getChildAt(a).getComponent(t).isOpen&&e.push(a)}return e}getValidPoint(){}onUpdate(){if(this.isGotCheese)return void(this.targetNode=u.Share.propNode.getChildByName("DesDoor"));if(this.curId==u.Share.cheeseId)return void(this.targetNode=u.Share.propNode.getChildByName("Cheese"));let e=this.getValidPos();e.length>0&&-1!=e.indexOf(this.curId)?this.targetNode=u.Share.currentPosNode.getChildAt(this.curId):this.targetNode=null,null==this.targetNode&&(this.targetNode=u.Share.currentPointsNode.getChildAt(this.curId))}onLateUpdate(){if(null==this.targetNode||this.tempTargetNode==this.targetNode||this.isHurt||u.Share.isDefeat)"walk"==this._ani.getCurrentAnimatorPlayState().animatorState.name&&this.playAniByName("idle"),this._body.linearVelocity=new Laya.Vector3(0,0,0);else{this.myOwner.transform.lookAt(this.targetNode.transform.position.clone(),new Laya.Vector3(0,1,0)),this.myOwner.transform.localRotationEulerY+=180;let e=new Laya.Vector3(0,0,0);Laya.Vector3.subtract(this.targetNode.transform.position.clone(),this.myOwner.transform.position.clone(),e),Laya.Vector3.normalize(e,e),e=new Laya.Vector3(e.x*this.speed,e.y*this.speed,e.z*this.speed);let t=new Laya.Vector3(0,0,0);Laya.Vector3.add(this.myOwner.transform.position.clone(),e,t),this.myOwner.transform.position=t.clone(),"walk"!=this._ani.getCurrentAnimatorPlayState().animatorState.name&&this.playAniByName("walk"),Laya.Vector3.distance(this.myOwner.transform.position.clone(),this.targetNode.transform.position.clone())<=.4&&("PosNode"==this.targetNode.parent.name?this.curId+=1:this.curId>=u.Share.currentPosNode.numChildren&&(this.curId+=1),this.tempTargetNode=this.targetNode)}}onTriggerEnter(e){}onCollisionEnter(e){let t=e.other.owner;-1==t.name.search("Mouse")&&this.checkIsProp(t)}checkIsProp(e){switch(e.name){case a.PROP_CLIP:break;case a.PROP_INDOOR:this.triggerInDoor();break;case a.PROP_PEPPER:this.triggerPepper();break;case a.PROP_FIRE:this.triggerFire();break;case a.PROP_COIN:this.triggerCoin();break;case a.PROP_CHEESE:break;case a.PROP_DESDOOR:this.myOwner.destroy(),console.log("des door")}}triggerClip(e){e.removeSelf(),this.isHurt=!0,this.playAniByName("hurt"),this._body.isTrigger=!0}triggerInDoor(){let e=u.Share.getPropByName(a.PROP_OUTDOOR),t=parseInt(e.getChildAt(0).name),i=e.transform.position.clone();this.myOwner.transform.position=i,this.curId=t-1,this.tempTargetNode=null}triggerPepper(){}triggerFire(){}triggerCoin(){}}class s extends Laya.Script3D{constructor(){super(),this.myOwner=null,this._ani=null,this._body=null,this.targetNode=null,this.tempTargetNode=null,this.prePosArr=[],this.isHurt=!1,this.isCatchMouse=!1,this.isStayPoint=!0,this.isIncreaseId=!1,this.curId=3,this.speed=.04}onAwake(){this.myOwner=this.owner,this.curId=parseInt(this.myOwner.getChildAt(0).name),this._ani=this.myOwner.getComponent(Laya.Animator),this._body=this.myOwner.getComponent(Laya.Rigidbody3D),this._body.linearVelocity=new Laya.Vector3(0,0,0),this.targetNode=u.Share.currentPointsNode.getChildAt(this.curId)}playAniByName(e){this._ani.play(e)}getValidPos(){let e=[];for(let a=0;a<u.Share.currentCollNode.numChildren;a++){u.Share.currentCollNode.getChildAt(a).getComponent(t).isOpen&&e.push(a)}return e}checkCanCatchMouse(){let e=[],t=this.curId;for(let a=0;a<u.Share._MouseNode.numChildren;a++){let s=u.Share._MouseNode.getChildAt(a),n=s.getComponent(i).curId;(t==n||this.checkContinues(t,n))&&e.push(s)}return e}checkContinues(e,t){let a=this.getValidPos();if(a.length<=0)return!1;if(e>t){for(let i=t;i<e;i++)if(-1==a.indexOf(i))return!1}else for(let i=e;i<t;i++)if(-1==a.indexOf(i))return!1;return!0}closestMouse(e){return e.length<=0?null:(e.sort((e,t)=>Laya.Vector3.distance(this.myOwner.transform.position.clone(),e.transform.position.clone())-Laya.Vector3.distance(this.myOwner.transform.position.clone(),t.transform.position.clone())),e[0])}onUpdate(){if(u.Share.isOver)return;this.targetNode=null,this.isCatchMouse=!1;let e=this.checkCanCatchMouse();if(e.length>0){this.isCatchMouse=!0;let t=this.closestMouse(e),a=this.curId,s=t.getComponent(i).curId;a==s?this.targetNode=t:a>s?(this.isIncreaseId=!0,this.isStayPoint?this.targetNode=u.Share.currentPosNode.getChildAt(this.curId-1):this.targetNode=u.Share.currentPointsNode.getChildAt(this.curId)):(this.isIncreaseId=!1,this.isStayPoint?this.targetNode=u.Share.currentPosNode.getChildAt(this.curId):this.targetNode=u.Share.currentPointsNode.getChildAt(this.curId+1))}else{let e=this.getValidPos();if(e.length>0)for(let t=0;t<e.length;t++){let a=e[t],i=this.curId;if(Math.abs(a-i)<=1&&this.isStayPoint&&-1==this.prePosArr.indexOf(a))return this.targetNode=u.Share.currentPosNode.getChildAt(a),void(this.isIncreaseId=i>a)}this.isStayPoint||(this.targetNode=u.Share.currentPointsNode.getChildAt(this.curId))}}onLateUpdate(){if(!this.targetNode||this.tempTargetNode==this.targetNode||this.isHurt||u.Share.isOver)"walk"==this._ani.getCurrentAnimatorPlayState().animatorState.name&&this.playAniByName("idle"),this._body.linearVelocity=new Laya.Vector3(0,0,0);else{this.myOwner.transform.lookAt(this.targetNode.transform.position.clone(),new Laya.Vector3(0,1,0)),this.myOwner.transform.localRotationEulerY+=180;let e=new Laya.Vector3(0,0,0);Laya.Vector3.subtract(this.targetNode.transform.position.clone(),this.myOwner.transform.position.clone(),e),Laya.Vector3.normalize(e,e),e=new Laya.Vector3(e.x*this.speed,e.y*this.speed,e.z*this.speed);let t=new Laya.Vector3(0,0,0);Laya.Vector3.add(this.myOwner.transform.position.clone(),e,t),this.myOwner.transform.position=t.clone(),"walk"!=this._ani.getCurrentAnimatorPlayState().animatorState.name&&this.playAniByName("walk");let a=Laya.Vector3.distance(this.myOwner.transform.position.clone(),this.targetNode.transform.position.clone());this.targetNode.parent&&"MouseNode"==this.targetNode.parent.name&&a<=1?(u.Share.mouseIsCaught(this.targetNode),this.targetNode=null,this.tempTargetNode=this.targetNode):this.targetNode.parent&&"PosNode"==this.targetNode.parent.name&&a<=.3?(this.isCatchMouse?this.isIncreaseId?this.curId--:this.curId++:this.isIncreaseId?this.curId--:this.curId+1>=u.Share.currentCollNode.numChildren&&(this.curId=0),this.prePosArr.push(u.Share.currentPosNode.getChildIndex(this.targetNode)),this.isStayPoint=!1,this.tempTargetNode=this.targetNode):this.targetNode.parent&&"PointNode"==this.targetNode.parent.name&&a<=.3&&(this.isCatchMouse&&(this.isIncreaseId?this.curId--:this.curId++,this.isStayPoint=!0),this.isStayPoint=!0,this.tempTargetNode=this.targetNode)}}onCollisionEnter(e){}checkIsProp(e){switch(e.name){case a.PROP_CLIP:this.triggerClip(e)}}triggerClip(e){e.removeSelf(),this.isHurt=!0,this.playAniByName("hurt"),this._body.isTrigger=!0}}class n extends Laya.Script3D{constructor(){super(),this.myOwner=null,this.gotCount=0}onAwake(){this.myOwner=this.owner}onUpdate(){if(u.Share._MouseNode)for(let e=0;e<u.Share._MouseNode.numChildren;e++){let t=u.Share._MouseNode.getChildAt(e),a=t.getComponent(i);Laya.Vector3.distance(t.transform.position.clone(),this.myOwner.transform.position.clone())<=1&&!a.isGotCheese&&(a.isGotCheese=!0,this.gotCount++,this.gotCount>=u.Share.countForWin&&u.Share.winCallback(),console.log("got cheese"))}}}class r{constructor(){this.grade=1,this.power=10,this.coin=0,this.playerId=0,this.playerArr=[],this.unlockSkinCount=0,this.exitTime=0}}class o{static getPlayerData(){if(localStorage.getItem("playerData"))null==this._playerData&&(this._playerData=JSON.parse(localStorage.getItem("playerData")));else{this._playerData=new r;for(let e=0;e<9;e++)0==e?this._playerData.playerArr.push(1):this._playerData.playerArr.push(0);localStorage.setItem("playerData",JSON.stringify(this._playerData))}return this._playerData}static setPlayerData(){localStorage.setItem("playerData",JSON.stringify(this._playerData))}static getPlayerYet(){let e=[];for(let t=0;t<this._playerData.playerArr.length;t++)this._playerData.playerArr[t]<0&&e.push(t);return e}static changeCoin(e){this._playerData.coin+=e,this.setPlayerData()}static getPlayerSkin(e){this._playerData.playerArr[e]=1,this._playerData.playerId=e,this.setPlayerData()}static setExitTime(){this._playerData.exitTime=(new Date).getTime(),this.setPlayerData()}static decPower(){this._playerData.power--,this.setPlayerData()}static getPower(e){this._playerData.power+=e,this.setPlayerData()}}o._playerData=null,o.tempSkinId=-1,o.freeSkinId=-1,o.powerMax=10;class h extends Laya.Script3D{constructor(){super(),this.myOwner=null}onAwake(){this.myOwner=this.owner}onUpdate(){if(u.Share._Cat&&Laya.Vector3.distance(u.Share._Cat.transform.position.clone(),this.myOwner.transform.position.clone())<=.8){u.Share._Cat.getComponent(s).triggerClip(this.myOwner)}for(let e=0;e<u.Share._MouseNode.numChildren;e++){let t=u.Share._MouseNode.getChildAt(e),a=t.getComponent(i);Laya.Vector3.distance(t.transform.position.clone(),this.myOwner.transform.position.clone())<=.5&&a.triggerClip(this.myOwner)}}}class l{constructor(){this.tCount=0,l.Share=this,this.init()}init(){localStorage.getItem("powerTime")?this.tCount=parseInt(localStorage.getItem("powerTime")):localStorage.setItem("power","0"),this.calculateExitTime(),Laya.Browser.onWeiXin&&(Laya.Browser.window.wx.onShow(e=>{this.calculateExitTime()}),Laya.Browser.window.wx.onHide(e=>{localStorage.setItem("powerTime",this.tCount.toString()),localStorage.setItem("exitTime",(new Date).getTime().toString())})),Laya.timer.loop(1e3,this,this.calculateTime)}calculateExitTime(){let e=0;if(localStorage.getItem("exitTime")&&(e=(new Date).getTime()-parseInt(localStorage.getItem("exitTime"))),e<=0)return;e/=1e3;let t=Math.floor(e/600);o.getPlayerData().power+=t,o.getPlayerData().power>o.powerMax&&(o.getPlayerData().power=o.powerMax,o.setPlayerData())}calculateTime(){this.tCount<=0?o.getPlayerData().power<o.powerMax?this.tCount=600:this.tCount=0:(this.tCount--,this.tCount<=0&&o.getPlayerData().power<o.powerMax&&(o.getPlayerData().power+=1,o.setPlayerData(),this.tCount=o.getPlayerData().power<o.powerMax?600:0))}}class d{static get instance(){return this._instance||(this._instance=new d),this._instance}initLoading(e){var t=[{url:"res/sounds/bgm.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/castleHit1.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/castleHit2.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/castleHit3.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/die1.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/die2.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/getCoin.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/weaponHit1.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/weaponHit2.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/weaponHit3.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/weaponHit4.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/weaponReady.mp3",type:Laya.Loader.SOUND}];Laya.loader.load(t,Laya.Handler.create(this,e)),Laya.SoundManager.useAudioMusic=!0,Laya.SoundManager.setMusicVolume(1)}playMusic(e,t=0,a){Laya.SoundManager.playMusic("res/sounds/"+e,t,new Laya.Handler(this,a))}stopMusic(){Laya.SoundManager.stopMusic()}playSoundEffect(e,t=1,a){Laya.SoundManager.playSound("res/sounds/"+e,t,new Laya.Handler(this,a))}}class c{constructor(){this.bannerUnitId=["adunit-441b22cb32c3f6b7","adunit-ca1d1fda0b8c4a03"],this.videoUnitId="adunit-c35dcf999bc0fcf3",this.bannerAd=null,this.videoAd=null,this.videoCallback=null,this.curBannerId=0,this.showBannerCount=0,this.videoIsError=!1,this.videoLoaded=!1}static get instance(){return this._instance||(this._instance=new c),this._instance}initAd(){Laya.Browser.onWeiXin&&(this.initBanner(),this.initVideo())}initBanner(){let e=!1;Laya.Browser.onWeiXin&&Laya.Browser.window.wx.getSystemInfo({success:t=>{-1!=t.model.search("iPhone X")&&(e=!0)}});let t=Laya.Browser.window.wx.getSystemInfoSync();this.bannerAd=Laya.Browser.window.wx.createBannerAd({adUnitId:this.bannerUnitId[this.curBannerId],style:{left:0,top:0,width:0,height:300}}),this.bannerAd.onResize(a=>{this.bannerAd.style.top=e?t.windowHeight-this.bannerAd.style.realHeight-10:t.windowHeight-this.bannerAd.style.realHeight,this.bannerAd.style.left=t.windowWidth/2-this.bannerAd.style.realWidth/2}),this.bannerAd.onError(e=>{console.log("banner error:",JSON.stringify(e))})}hideBanner(){Laya.Browser.onWeiXin&&this.bannerAd.hide()}showBanner(){Laya.Browser.onWeiXin&&(this.showBannerCount++,this.bannerAd.show())}destroyBanner(){Laya.Browser.onWeiXin&&this.bannerAd&&(this.bannerAd.destroy(),this.bannerAd=null)}initVideo(){Laya.Browser.onWeiXin&&(this.videoAd||(this.videoAd=Laya.Browser.window.wx.createRewardedVideoAd({adUnitId:this.videoUnitId})),this.loadVideo(),this.videoAd.onLoad(()=>{console.log("激励视频加载成功"),this.videoLoaded=!0}),this.videoAd.onError(e=>{console.log("video Error:",JSON.stringify(e)),this.videoIsError=!0}))}loadVideo(){Laya.Browser.onWeiXin&&null!=this.videoAd&&(this.videoIsError=!1,this.videoAd.load())}showVideo(t){if(this.videoCallback=t,Laya.Browser.onWeiXin)return this.videoIsError?(y.instance.shareGame(t),void this.loadVideo()):void(0!=this.videoLoaded?(this.videoAd&&this.videoAd.offClose(),Laya.SoundManager.muted=!0,this.videoAd.onClose(e=>{e&&e.isEnded||void 0===e?(console.log("正常播放结束，可以下发游戏奖励"),this.videoCallback()):console.log("播放中途退出，不下发游戏奖励"),Laya.SoundManager.muted=!1,this.videoLoaded=!1,this.loadVideo()}),this.videoAd.show()):e.OpenAlert("视频正在加载中！"));this.videoCallback()}}class y{constructor(){this.path="",this.picCount=3,this.preT=0,this.shareTips=["请分享到活跃的群！","请分享到不同群！","请分享给好友！","请分享给20人以上的群！"]}static get instance(){return this._instance||(this._instance=new y),this._instance}initShare(){if(Laya.Browser.onWeiXin){Laya.Browser.window.wx.showShareMenu({withShareTicket:!0});let t="",a="";Laya.Browser.window.wx.onShareAppMessage(function(e){return{title:a,imageUrl:t}}),Laya.Browser.window.wx.onShow(t=>{if(d.instance.playMusic("bgm.mp3"),e.shareCallback){((new Date).getTime()-e.shareTime)/1e3>=3&&!e.firstShare?(e.shareCallback(),e.front_share_number--,Laya.Browser.window.wx.showToast({title:"分享成功",icon:"none",duration:2e3}),e.shareCallback=null):(e.firstShare=!1,Laya.Browser.window.wx.showModal({title:"提示",content:this.shareTips[Math.floor(Math.random()*this.shareTips.length)],confirmText:"重新分享",success(t){t.confirm?(console.log("用户点击确定"),y.instance.shareGame(e.shareCallback)):t.cancel&&console.log("用户点击取消")}}))}})}}shareGame(t){if(e.front_share_number<=0)return void c.instance.showVideo(t);if(e.shareCallback=t,!Laya.Browser.onWeiXin)return void t();e.shareTime=(new Date).getTime();Laya.Browser.window.wx.shareAppMessage({title:"",imageUrl:""})}}class u{constructor(){this._gradeScene=null,this._Cat=null,this._MouseNode=null,this.currentCollNode=null,this.currentPointsNode=null,this.currentPosNode=null,this.validPointArr=[],this.propNode=null,this.cheeseId=-1,this.countForWin=10,this.isVictory=!1,this.isDefeat=!1,this.isOver=!1,localStorage.clear(),u.Share=this,y.instance.initShare(),o.getPlayerData(),new l,Laya.Scene.open("MyScenes/LoadingUI.scene")}initScene(){Laya.Scene3D.load(e.UnityPath+"Scene1.ls",Laya.Handler.create(this,this.onLoadScene))}onLoadScene(e){this._scene=Laya.stage.addChild(e),Laya.stage.setChildIndex(this._scene,0),this._camera=this._scene.getChildByName("Main Camera"),this._light=this._scene.getChildByName("Directional Light"),this.createGameScene()}createGameScene(){let t=o.getPlayerData().grade,a=Laya.loader.getRes(e.UnityPath+"Scene"+t+".lh");this._gradeScene=Laya.Sprite3D.instantiate(a,this._scene,!1,new Laya.Vector3(0,0,0)),this._Cat=this._gradeScene.getChildByName("Cat"),this._MouseNode=this._gradeScene.getChildByName("MouseNode"),this.currentCollNode=this._gradeScene.getChildByName("CollNode"),this.currentPointsNode=this._gradeScene.getChildByName("PointNode"),this.currentPosNode=this._gradeScene.getChildByName("PosNode"),this.propNode=this._gradeScene.getChildByName("PropNode"),this.addCollComponents(),this.addPropComponents(),this.countForWin=this._MouseNode.numChildren-3;for(let e=0;e<this._MouseNode.numChildren;e++){this._MouseNode.getChildAt(e).addComponent(i)}this._Cat&&this._Cat.addComponent(s)}addCollComponents(){for(let e=0;e<this.currentCollNode.numChildren;e++){this.currentCollNode.getChildAt(e).addComponent(t)}}addPropComponents(){if(this.propNode.getChildByName("Cheese")){let e=this.propNode.getChildByName("Cheese");e.addComponent(n),e.numChildren>0&&(this.cheeseId=parseInt(e.getChildAt(0).name))}if(this.propNode.getChildByName("Clip")){this.propNode.getChildByName("Clip").addComponent(h)}}getPropByName(e){return this.propNode.getChildByName(e)}mouseIsCaught(e){e.destroy(),this._MouseNode.numChildren<this.countForWin&&this.gameOverCallback()}winCallback(){this.isVictory||(this.isVictory=!0,this.isOver=!0,Laya.Scene.open("MyScenes/VictoryUI.scene"))}gameOverCallback(){this.isDefeat||(this.isDefeat=!0,this.isOver=!0,Laya.Scene.open("MyScenes/DefeatUI.scene"))}restartGame(){this.isVictory=!1,this.isDefeat=!1,this.isOver=!1,this._gradeScene.removeChildren(),this._gradeScene.removeSelf(),this._gradeScene=null,this.createGameScene()}}class g extends Laya.Scene{constructor(){super(),this.gradeNum=this.gradeNum,this.gradeBar=this.gradeBar,this.tipsBtn=this.tipsBtn,this.noBtn=this.noBtn}onOpened(){this.tipsBtn.on(Laya.Event.CLICK,this,this.tipsBtnCB),this.noBtn.on(Laya.Event.CLICK,this,this.noBtnCB)}onClosed(){}tipsBtnCB(){}noBtnCB(){Laya.Scene.open("MyScenes/StartUI.scene"),u.Share.restartGame()}}class p extends Laya.Script{constructor(){super()}onAwake(){let e=this.owner;e.y=e.y*Laya.stage.displayHeight/1334}}class m extends Laya.Scene{constructor(){super(),this.selectColl=null,this.collMoveDir=new Laya.Vector3(0,0,0),this.prePos=new Laya.Vector2(0,0),this.touchPanel=this.touchPanel,this.gradeNum=this.gradeNums}onOpened(e){this.initData()}onClosed(){Laya.timer.clearAll(this)}initData(){this.touchPanel.on(Laya.Event.MOUSE_DOWN,this,this.touchStart),this.touchPanel.on(Laya.Event.MOUSE_MOVE,this,this.touchMove),this.touchPanel.on(Laya.Event.MOUSE_UP,this,this.touchEnd),this.gradeNum.value=o.getPlayerData().grade.toString()}touchStart(e){let a=new Laya.Vector2(e.stageX,e.stageY),i=new Laya.HitResult,s=new Laya.Ray(new Laya.Vector3(0,0,0),new Laya.Vector3(0,0,0));if(u.Share._camera.viewportPointToRay(a,s),u.Share._scene.physicsSimulation.rayCast(s,i),i.succeeded&&"Coll"==i.collider.owner.name){console.log(i.collider.owner.name),i.collider.owner.parent.getComponent(t).clicked()}}touchMove(e){}touchEnd(e){}}class w extends Laya.Scene{constructor(){super(),this.bar=this.bar,this.cheese=this.cheese,this.perNum=this.perNum}onOpened(){Laya.Browser.onWeiXin?this.loadSubpackage():this.loadRes()}onClosed(){}loadSubpackage(){Laya.Browser.window.wx.loadSubpackage({name:"unity",success:e=>{this.loadRes()},fail:e=>{this.loadSubpackage()}}).onProgressUpdate(e=>{console.log("下载进度",e.progress),console.log("已经下载的数据长度",e.totalBytesWritten),console.log("预期需要下载的数据总长度",e.totalBytesExpectedToWrite),this.perNum.value=Math.floor(e.progress/2)+"%",this.bar.width=e.progress/50*300,this.cheese.x=75+this.bar.width})}loadRes(){var t=[e.UnityPath+"Scene1.lh",e.UnityPath+"Scene2.lh",e.UnityPath+"Scene3.lh",e.UnityPath+"Scene4.lh",e.UnityPath+"Scene5.lh"];Laya.loader.create(t,Laya.Handler.create(this,this.onComplete),Laya.Handler.create(this,this.onProgress))}onComplete(){Laya.Scene.open("MyScenes/StartUI.scene"),u.Share.initScene()}onProgress(e){this.bar.width=300+300*e,this.perNum.value=(50+Math.floor(50*e)).toString()+"%",this.cheese.x=75+this.bar.width}}class L extends Laya.Scene{constructor(){super(),this.closeBtn=this.closeBtn,this.getPowerBtn=this.getPowerBtn}onOpened(){this.getPowerBtn.on(Laya.Event.CLICK,this,this.getPowerBtnCB),this.closeBtn.on(Laya.Event.CLICK,this,this.closeBtnCB)}onClosed(){}getPowerBtnCB(){y.instance.shareGame(()=>{o.getPower(5),this.closeBtnCB()})}closeBtnCB(){this.close()}}class C extends Laya.Scene{constructor(){super(),this.topBg=this.topBg,this.bgPic=this.bgPic,this.backBtn=this.backBtn,this.skinPic=this.skinPic,this.coinNum=this.coinNum,this.skinNode=this.skinNode,this.unlockBtn=this.unlockBtn,this.unlockNum=this.unlockNum,this.chosenId=-1}onOpened(){Laya.timer.frameLoop(1,this,this.undateCB),this.backBtn.on(Laya.Event.CLICK,this,this.backBtnCB),this.unlockBtn.on(Laya.Event.CLICK,this,this.unlockBtnCB),this.skinPic.skin="pfsy/pfsy_pf/m_"+(o.getPlayerData().playerId+1)+".png",this.topBg.y=this.bgPic.y-this.topBg.height,this.initItems()}onClosed(){Laya.timer.clearAll(this)}initItems(){for(let e=0;e<this.skinNode.numChildren;e++){let t=this.skinNode.getChildAt(e),a=t.getChildByName("bg"),i=t.getChildByName("pic"),s=t.getChildByName("tick");s.visible=!1,o.getPlayerData().playerId==e?(a.skin="pfk/pfk_ysz.png",s.visible=!0):1==o.getPlayerData().playerArr[e]?a.skin="pfk/pfk_yjs.png":0==o.getPlayerData().playerArr[e]&&(e==this.chosenId?a.skin="pfk/pfk_xzjs.png":a.skin="pfk/pfk_wjs.png"),i.skin="pfsy/pfsy_pf/m_"+(e+1)+".png",i.visible=1==o.getPlayerData().playerArr[e],t.off(Laya.Event.CLICK,this,this.itemCB),t.on(Laya.Event.CLICK,this,this.itemCB,[e])}}itemCB(e){this.chosenId=-1,o.getPlayerData().playerId!=e&&(1==o.getPlayerData().playerArr[e]?o.getPlayerData().playerId=e:0==o.getPlayerData().playerArr[e]&&(this.chosenId=e),this.initItems())}undateCB(){this.coinNum.value=o.getPlayerData().coin.toString()}unlockBtnCB(){}backBtnCB(){Laya.Scene.open("MyScenes/StartUI.scene")}}class S extends Laya.Scene{constructor(){super(),this.powerNum=this.powerNum,this.coinNum=this.coinNum,this.gradeNum=this.gradeNum,this.gradeBar=this.gradeBar,this.powerTime=this.powerTime,this.startBtn=this.startBtn,this.signBtn=this.signBtn,this.skinBtn=this.skinBtn}onOpened(e){this.startBtn.on(Laya.Event.CLICK,this,this.startBtnCB),this.signBtn.on(Laya.Event.CLICK,this,this.signBtnCB),this.skinBtn.on(Laya.Event.CLICK,this,this.skinBtnCB),this.gradeNum.value=o.getPlayerData().grade.toString(),Laya.timer.frameLoop(1,this,this.updateCB)}onClosed(){Laya.timer.clearAll(this)}startBtnCB(){o.getPlayerData().power<=0?Laya.Scene.open("MyScenes/PowerUI.scene",!1):(o.decPower(),Laya.Scene.open("MyScenes/GameUI.scene"))}signBtnCB(){}skinBtnCB(){Laya.Scene.open("MyScenes/SkinUI.scene")}updateCB(){this.calculatePowerTime(),this.coinNum.value=o.getPlayerData().coin.toString()}calculatePowerTime(){let e=l.Share.tCount,t=Math.floor(e/60),a=Math.floor(e-60*t);this.powerTime.text=t.toString()+":"+a.toString(),this.powerNum.value=o.getPlayerData().power.toString(),this.powerTime.visible=o.getPlayerData().power<o.powerMax}}class B extends Laya.Scene{constructor(){super(),this.noBounes=this.noBounes,this.bounesNode=this.bounesNode,this.gradeNum=this.gradeNum,this.gradeBar=this.gradeBar,this.coinNum=this.coinNum,this.nextBtn=this.nextBtn,this.gradeNum1=this.gradeNum1,this.skinPic=this.skinPic,this.getSkinBtn=this.getSkinBtn,this.noBtn=this.noBtn}onOpened(){this.nextBtn.on(Laya.Event.CLICK,this,this.nextBtnCB),this.getSkinBtn.on(Laya.Event.CLICK,this,this.getSkinBtnCB),this.noBtn.on(Laya.Event.CLICK,this,this.noBtnCB)}onClosed(){}nextBtnCB(){this.updateGrade(),Laya.Scene.open("MyScenes/StartUI.scene"),u.Share.restartGame()}getSkinBtnCB(){}noBtnCB(){this.updateGrade(),Laya.Scene.open("MyScenes/StartUI.scene"),u.Share.restartGame()}updateGrade(){o.getPlayerData().grade++,o.getPlayerData().grade>5&&(o.getPlayerData().grade=1),o.setPlayerData()}}class N{constructor(){}static init(){var e=Laya.ClassUtils.regClass;e("View/DefeatUI.ts",g),e("Libs/FixNodeY.ts",p),e("View/GameUI.ts",m),e("View/LoadingUI.ts",w),e("View/PowerUI.ts",L),e("View/SkinUI.ts",C),e("View/StartUI.ts",S),e("View/VictoryUI.ts",B)}}N.width=750,N.height=1334,N.scaleMode="fixedwidth",N.screenMode="vertical",N.alignV="middle",N.alignH="center",N.startScene="MyScenes/DefeatUI.scene",N.sceneRoot="",N.debug=!1,N.stat=!1,N.physicsDebug=!1,N.exportSceneToJson=!0,N.init();new class{constructor(){window.Laya3D?Laya3D.init(N.width,N.height):Laya.init(N.width,N.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=N.scaleMode,Laya.stage.screenMode=N.screenMode,Laya.stage.alignV=N.alignV,Laya.stage.alignH=N.alignH,Laya.URL.exportSceneToJson=N.exportSceneToJson,(N.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),N.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),N.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){new u}}}();